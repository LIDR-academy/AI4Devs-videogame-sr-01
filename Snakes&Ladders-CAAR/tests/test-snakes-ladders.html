<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Serpientes y Escaleras</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f0f0f0;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .test-board {
        display: grid;
        grid-template-columns: repeat(10, 30px);
        gap: 2px;
        margin: 20px 0;
      }
      .test-cell {
        width: 30px;
        height: 30px;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        background: white;
      }
      .ladder-start {
        background: #90ee90 !important;
      }
      .ladder-end {
        background: #32cd32 !important;
      }
      .snake-start {
        background: #ffb6c1 !important;
      }
      .snake-end {
        background: #ff1493 !important;
      }
      .player {
        background: #ffd700 !important;
        font-size: 14px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #45a049;
      }
      .info {
        background: #e7f3ff;
        padding: 10px;
        border-left: 4px solid #2196f3;
        margin: 10px 0;
      }
      .error {
        background: #ffebee;
        padding: 10px;
        border-left: 4px solid #f44336;
        margin: 10px 0;
      }
      .success {
        background: #e8f5e8;
        padding: 10px;
        border-left: 4px solid #4caf50;
        margin: 10px 0;
      }
    </style>
  </head>
  <body class="test-page">
    <h1>🧪 Test de Serpientes y Escaleras</h1>

    <div class="test-container">
      <h2>🎯 Objetivo</h2>
      <p>
        Verificar que las serpientes y escaleras funcionan correctamente al
        generar el tablero y mover jugadores.
      </p>

      <div class="info">
        <strong>Leyenda de colores:</strong><br />
        🟢 Verde claro: Inicio de escalera | 🟢 Verde oscuro: Final de
        escalera<br />
        🌸 Rosa claro: Inicio de serpiente | 🌺 Rosa oscuro: Final de
        serpiente<br />
        🟡 Amarillo: Posición actual del jugador
      </div>
    </div>

    <div class="test-container">
      <h2>🎲 Controles de Prueba</h2>
      <button onclick="generateNewBoard()">🎲 Generar Nuevo Tablero</button>
      <button onclick="testPosition(16)">📍 Mover a Casilla 16</button>
      <button onclick="testPosition(31)">📍 Mover a Casilla 31</button>
      <button onclick="testPosition(87)">📍 Mover a Casilla 87</button>
      <button onclick="testPosition(93)">📍 Mover a Casilla 93</button>
      <button onclick="testSnakesAndLadders()">🧪 Test Automático</button>
    </div>

    <div class="test-container">
      <h2>🏁 Estado del Test</h2>
      <div id="testStatus"></div>
      <div id="testResults"></div>
    </div>

    <div class="test-container">
      <h2>🎮 Tablero de Prueba</h2>
      <div class="test-board" id="testBoard"></div>
    </div>

    <div class="test-container">
      <h2>📊 Elementos Generados</h2>
      <div id="gameElements"></div>
    </div>

    <script src="test-classes.js"></script>
    <script>
      let testGame;
      let testPlayer;

      function initTest() {
        console.log("🧪 Inicializando test de serpientes y escaleras");

        // Crear instancia de juego para testing
        testGame = {
          board: new Board(),
          players: [new Player("TestPlayer", "🧪", 1)],
        };

        testPlayer = testGame.players[0];
        testPlayer.position = 0;

        generateNewBoard();
      }

      function generateNewBoard() {
        console.log("🎲 Generando nuevo tablero...");

        testGame.board.generate();
        renderTestBoard();
        showGameElements();

        updateStatus("✅ Nuevo tablero generado", "success");
      }

      function renderTestBoard() {
        const boardDiv = document.getElementById("testBoard");
        boardDiv.innerHTML = "";

        // Crear celdas del tablero (numeración zigzag)
        for (let row = 0; row < 10; row++) {
          for (let col = 0; col < 10; col++) {
            const cell = document.createElement("div");
            cell.className = "test-cell";

            const cellNumber = getCellNumber(row, col);
            cell.textContent = cellNumber;
            cell.id = `test-cell-${cellNumber}`;

            // Marcar escaleras
            const ladder = testGame.board.ladders.find(
              (l) => l.from === cellNumber
            );
            const ladderEnd = testGame.board.ladders.find(
              (l) => l.to === cellNumber
            );

            if (ladder) {
              cell.classList.add("ladder-start");
              cell.title = `Escalera: ${ladder.from} → ${ladder.to}`;
            }
            if (ladderEnd) {
              cell.classList.add("ladder-end");
              cell.title = `Final escalera: ${ladderEnd.from} → ${ladderEnd.to}`;
            }

            // Marcar serpientes
            const snake = testGame.board.snakes.find(
              (s) => s.from === cellNumber
            );
            const snakeEnd = testGame.board.snakes.find(
              (s) => s.to === cellNumber
            );

            if (snake) {
              cell.classList.add("snake-start");
              cell.title = `Serpiente: ${snake.from} → ${snake.to}`;
            }
            if (snakeEnd) {
              cell.classList.add("snake-end");
              cell.title = `Final serpiente: ${snakeEnd.from} → ${snakeEnd.to}`;
            }

            // Marcar jugador
            if (testPlayer.position === cellNumber) {
              cell.classList.add("player");
              cell.textContent = testPlayer.avatar;
            }

            boardDiv.appendChild(cell);
          }
        }
      }

      // Función auxiliar para numeración zigzag
      function getCellNumber(row, col) {
        const rowFromBottom = 9 - row;
        if (rowFromBottom % 2 === 0) {
          return rowFromBottom * 10 + col + 1;
        } else {
          return rowFromBottom * 10 + (10 - col);
        }
      }

      function testPosition(position) {
        console.log(`📍 Testeando posición ${position}`);

        // Mover jugador a la posición
        testPlayer.position = position;

        // Verificar si hay serpiente o escalera
        const ladder = testGame.board.ladders.find((l) => l.from === position);
        const snake = testGame.board.snakes.find((s) => s.from === position);

        let resultMsg = `Jugador movido a casilla ${position}`;
        let resultType = "info";

        if (ladder) {
          testPlayer.position = ladder.to;
          resultMsg += ` → 🪜 Escalera encontrada! ${ladder.from} → ${ladder.to}`;
          resultType = "success";
        } else if (snake) {
          testPlayer.position = snake.to;
          resultMsg += ` → 🐍 Serpiente encontrada! ${snake.from} → ${snake.to}`;
          resultType = "error";
        } else {
          resultMsg += ` → ➡️ Sin elementos especiales`;
        }

        renderTestBoard();
        updateStatus(resultMsg, resultType);
      }

      function testSnakesAndLadders() {
        console.log("🧪 Ejecutando test automático...");

        let results = [];
        let passedTests = 0;
        let totalTests = 0;

        // Test 1: Verificar que se generaron escaleras
        totalTests++;
        if (testGame.board.ladders.length > 0) {
          results.push("✅ Se generaron escaleras correctamente");
          passedTests++;
        } else {
          results.push("❌ No se generaron escaleras");
        }

        // Test 2: Verificar que se generaron serpientes
        totalTests++;
        if (testGame.board.snakes.length > 0) {
          results.push("✅ Se generaron serpientes correctamente");
          passedTests++;
        } else {
          results.push("❌ No se generaron serpientes");
        }

        // Test 3: Probar escaleras
        for (let ladder of testGame.board.ladders.slice(0, 2)) {
          // Solo 2 primeras
          totalTests++;
          testPlayer.position = ladder.from;

          // Simular función checkSpecialCells
          const foundLadder = testGame.board.ladders.find(
            (l) => l.from === testPlayer.position
          );
          if (foundLadder && foundLadder.to === ladder.to) {
            testPlayer.position = ladder.to;
            results.push(`✅ Escalera ${ladder.from}→${ladder.to} funciona`);
            passedTests++;
          } else {
            results.push(`❌ Escalera ${ladder.from}→${ladder.to} no funciona`);
          }
        }

        // Test 4: Probar serpientes
        for (let snake of testGame.board.snakes.slice(0, 2)) {
          // Solo 2 primeras
          totalTests++;
          testPlayer.position = snake.from;

          // Simular función checkSpecialCells
          const foundSnake = testGame.board.snakes.find(
            (s) => s.from === testPlayer.position
          );
          if (foundSnake && foundSnake.to === snake.to) {
            testPlayer.position = snake.to;
            results.push(`✅ Serpiente ${snake.from}→${snake.to} funciona`);
            passedTests++;
          } else {
            results.push(`❌ Serpiente ${snake.from}→${snake.to} no funciona`);
          }
        }

        // Mostrar resultados
        const resultDiv = document.getElementById("testResults");
        resultDiv.innerHTML = `
                <h3>📊 Resultados del Test</h3>
                <p><strong>${passedTests}/${totalTests} tests pasaron (${Math.round(
          (passedTests / totalTests) * 100
        )}%)</strong></p>
                <ul>
                    ${results.map((r) => `<li>${r}</li>`).join("")}
                </ul>
            `;

        renderTestBoard();

        if (passedTests === totalTests) {
          updateStatus(
            `🎉 Todos los tests pasaron! (${passedTests}/${totalTests})`,
            "success"
          );
        } else {
          updateStatus(
            `⚠️ ${totalTests - passedTests} tests fallaron`,
            "error"
          );
        }
      }

      function showGameElements() {
        const elementsDiv = document.getElementById("gameElements");

        let html = "<h3>🪜 Escaleras</h3><ul>";
        for (let ladder of testGame.board.ladders) {
          html += `<li>Escalera: ${ladder.from} → ${ladder.to}</li>`;
        }
        html += "</ul>";

        html += "<h3>🐍 Serpientes</h3><ul>";
        for (let snake of testGame.board.snakes) {
          html += `<li>Serpiente: ${snake.from} → ${snake.to}</li>`;
        }
        html += "</ul>";

        elementsDiv.innerHTML = html;
      }

      function updateStatus(message, type = "info") {
        const statusDiv = document.getElementById("testStatus");
        statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
      }

      // Inicializar cuando la página cargue
      document.addEventListener("DOMContentLoaded", initTest);
    </script>
  </body>
</html>
